(function(a){a.fn.browserWrapper=function(b){var c={browserTitle:"Your Awesome Title",browserURL:"http://your.awesome.url.com",favicon:"http://browserwrapper.molovo.co.uk/img/favicon.png",filePath:"browserWrapper/src/",shadow:"0px 5px 15px rgba(0,0,0,0.3)",os:"mac",browser:"chrome",makeBrowserWork:!1},b=a.extend(c,b),d=a(this);a(".browser-gui"),a(".browser-window-border"),a(".browser-gui .address-bar"),d.height(),d.width();var j=d.html();if(c.makeBrowserWork&&(j.match(/<iframe/)||j.match(/<object/)))var k='contenteditable="true"';if("detect"==c.os||"detect"==c.browser){var l={init:function(){this.browser=this.searchString(this.dataBrowser)||"chrome",this.OS=this.searchString(this.dataOS)||"mac"},searchString:function(a){for(var b=0;a.length>b;b++){var c=a[b].string,d=a[b].prop;if(this.versionSearchString=a[b].versionSearch||a[b].identity,c){if(-1!=c.indexOf(a[b].subString))return a[b].identity}else if(d)return a[b].identity}},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"chrome"},{string:navigator.vendor,subString:"Apple",identity:"safari"},{string:navigator.userAgent,subString:"Firefox",identity:"firefox"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"windows"},{string:navigator.platform,subString:"Mac",identity:"mac"},{string:navigator.platform,subString:"Linux",identity:"linux"}]};l.init(),"detect"==c.os&&(c.os=l.OS),"detect"==c.browser&&(c.browser=l.browser)}if("mac"==c.os)var m='<img class="window-button red" src="'+c.filePath+'img/red-button.png" /><img class="window-button yellow" src="'+c.filePath+'img/yellow-button.png" /><img class="window-button green" src="'+c.filePath+'img/green-button.png" />';else if("windows"==c.os)var m='<img class="window-button" src="'+c.filePath+'img/windows-buttons.png" />';var n='<span class="tab '+c.browser+'"><span class="tab-wrapper"><img class="favicon" src="'+c.favicon+'" /><span class="tabtext">'+c.browserTitle+"</span></span></span>",o='<div class="browser-gui-controls '+c.browser+'"><img class="nav-buttons" src="'+c.filePath+"img/"+c.browser+'-nav-buttons.png" /><span class="address-bar notsearch">';"chrome"==c.browser&&(o+='<img class="address-bar-icon" src="'+c.filePath+'img/address-bar-icon.png" />'),o+='<span class="address-bar-text" '+k+">"+c.browserURL+"</span>",o+="chrome"==c.browser?'<img class="address-bar-bookmark" src="'+c.filePath+"img/"+c.browser+'-address-bar-bookmark.png" /></span><img class="nav-button-settings" src="'+c.filePath+'img/nav-button-settings.png" />':"firefox"==c.browser?'<img class="address-bar-bookmark" src="'+c.filePath+"img/"+c.browser+'-address-bar-bookmark.png" /></span><span class="address-bar firefox-google-search"><img class="address-bar-icon" src="'+c.filePath+'img/google-search-icon.png" /><span class="address-bar-text">Search Google</span></span>':"</span>",o+="</div>";var p='<div class="browser-window-controls '+c.os+" "+c.browser+'">'+m+n+"</div>";d.html('<div class="browser-window-border '+c.os+" "+c.browser+'" style="box-shadow:'+c.shadow+'">'+p+'<div class="browser-gui '+c.browser+'">'+o+j+"</div></div>").trigger("refresh"),k&&d.on("focus",".address-bar-text[contenteditable]",function(){var b=a(this);return b.data("before",b.html()),b}).on("blur keypress paste",".address-bar-text[contenteditable]",function(b){var c=b.keyCode||b.which;if(13!==c)return!0;b.preventDefault(),b.stopImmediatePropagation();var d=a(this);return d.data("before")!==d.html()&&d.trigger("change"),d}).find(".address-bar-text[contenteditable]").on("change",function(){var b=a(this),e=b.html();e.match(/^(https?|ftp):\/\/(.*)/)||(e="http://"+e,b.html(e)),d.find("iframe").attr("src",e);var f=d.find("object").clone().attr("data",e);d.find("object").remove(),d.find(".browser-content").append(f);var g=e.split("/").splice(0,3).join("/")+"/favicon"+".ico";d.find(".favicon").attr("onerror","this.src='"+c.favicon+"'").attr("src",g);var h=d.find("object").document.title;d.find(".tabtext").html(h)})}})(jQuery);